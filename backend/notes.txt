We should probably split the server code into class depending on how complex it gets.